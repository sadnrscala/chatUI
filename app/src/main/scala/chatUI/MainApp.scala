/*
 * This Scala source file was generated by the Gradle 'init' task.
 */
package chatUI

import chatUI.model.User
import chatUI.view.UsersOverviewController
import javafx.application.Application
import javafx.collections.{FXCollections, ListChangeListener, ObservableList}
import javafx.fxml.FXMLLoader
import javafx.scene.control.Label
import javafx.scene.layout.{HBox, VBox}
import javafx.scene.{Parent, Scene}
import javafx.stage.Stage


class MainApp extends Application {

  private var _stage:Stage = _
  private var _appLayout:HBox = _
  private val _usersData:ObservableList[User] = FXCollections.observableArrayList


  override def start(primaryStage: Stage): Unit = {


    stage = primaryStage
    stage.setTitle("p2p chat")

    initAppLayout()
    showUsersOverview()
  }


  override def stop(): Unit = {
  }


  def showUsersOverview(): Unit = {
    val loader = new FXMLLoader()
    loader.setLocation(getClass.getResource("view/UsersOverview.fxml"))


    val usersOverview:VBox = loader.load
    appLayout.getChildren.add(usersOverview)
    val usersOverviewController:UsersOverviewController = loader.getController
    usersOverviewController.mainApp = this
  }

  def initAppLayout(): Unit = {

    val loader = new FXMLLoader()
    loader.setLocation(getClass.getResource("view/ChatWindow.fxml"))

    appLayout = loader.load
    val scene = new Scene(appLayout)

    stage.setScene(scene)
    stage.show()
    /*
        usersData.addListener(new ListChangeListener[User] {
          override def onChanged(c: ListChangeListener.Change[_ <: User]): Unit = {
            //appLayout.getChildren.add(new Label("asdasd"))

          }
        })

     * */

    usersData.add(new User("user 1"))
    usersData.add(new User("user 2"))
  }


  // setters/getters
  def usersData:ObservableList[User] = _usersData

  def appLayout: HBox = _appLayout
  def appLayout_=(el:HBox) = _appLayout = el

  def stage: Stage = _stage
  def stage_= (s:Stage): Unit = _stage = s
}